
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Spring äº‹åŠ¡çš„ä¼ æ’­ç‰¹æ€§ - å°å¾„åˆ†å²”çš„èŠ±å›­</title>
  <meta name="author" content="khotyn">

  
  <meta name="description" content="">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://khotyn.github.com/blog/2013/09/14/spring-tx-propagation">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/bootstrap/bootstrap.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/stylesheets/bootstrap/responsive.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/stylesheets/syntax/syntax.css" media="screen, projection" rel="stylesheet" type="text/css">
  <style type="text/css">
    body {
      padding-bottom: 40px;
    }
    h1 {
      margin-bottom: 15px;
    }
    img {
      max-width: 100%;
    }
    .sharing, .meta, .pager {
      margin: 20px 0px 20px 0px;
    }
    .page-footer p {
      text-align: center;
    }
  </style>
  <script src="/javascripts/libs/jquery.js"></script>
  <script src="/javascripts/libs/modernizr-2.0.js"></script>
  <script src="/javascripts/libs/bootstrap.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="å°å¾„åˆ†å²”çš„èŠ±å›­" type="application/atom+xml">
  
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-44033767-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <nav role="navigation"><div class="navbar navbar-inverse">
  <div class="navbar-inner">
    <div class="container">
      <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </a>

      <a class="brand" href="/">å°å¾„åˆ†å²”çš„èŠ±å›­</a>

      <div class="nav-collapse">
        <ul class="nav">
  <li><a href="/blog/archives">ğŸ—‚å½’æ¡£</a></li>
  <li><a href="/about">ğŸ‘¨å…³äº</a></li>
  <li><a href="/hire">ğŸ‘¨â€ğŸ’»æ‹›è˜</a></li>
  <li><a href="https://github.com/khotyn" target="_blank">æˆ‘çš„ Github</a></li>
</ul>

        <ul class="nav pull-right" data-subscription="rss">
          <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
          
        </ul>

        
          <form class="pull-right navbar-search" action="https://google.com/search" method="get">
            <fieldset role="search">
              <input type="hidden" name="q" value="site:blog.khotyn.com" />
              <input class="search-query" type="text" name="q" results="0" placeholder="Search"/>
            </fieldset>
          </form>
        
      </div>
    </div>
  </div>
</div>
</nav>
  <div class="container">
    <div class="row-fluid">
      
<article class="hentry span9" role="article">

  
  <header class="page-header">
    
      <h1 class="entry-title">Spring äº‹åŠ¡çš„ä¼ æ’­ç‰¹æ€§</h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-09-14T18:06:00-05:00" pubdate data-updated="true">Sep 14<span>th</span>, 2013</time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>æœ€è¿‘å·¥ä½œä¸­æ¶‰åŠåˆ°äº†ä¸€ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡çš„äº§å“ï¼Œè¿™ä¸ªäº§å“æ˜¯åœ¨ Spring çš„äº‹åŠ¡ä¸Šåšçš„ï¼Œæˆ‘å¯¹å…¶ä¸­æ¶‰åŠåˆ°çš„ Spring çš„äº‹åŠ¡çš„ä¼ æ’­ç‰¹æ€§ä¸æ˜¯å¾ˆäº†è§£ï¼Œæ‰€ä»¥ä»Šå¤©èŠ±äº†ä¸€ä¸ªä¸‹åˆçš„æ—¶é—´è®¤çœŸäº†è§£äº†ä¸€ä¸‹ï¼Œå†™äº†ä¸€å †çš„æµ‹è¯•ä»£ç ã€‚</p>

<p>è¿›å…¥æ­£é¢˜ï¼ŒSpring çš„äº‹åŠ¡çš„ä¼ æ’­ç‰¹æ€§åˆ†ä¸ºä»¥ä¸‹çš„ä¸ƒç§ï¼š</p>

<ul>
  <li>PROPAGATION_REQUIRED</li>
  <li>PROPAGATION_SUPPORTS</li>
  <li>PROPAGATION_MANDATORY</li>
  <li>PROPAGATION_REQUIRES_NEW</li>
  <li>PROPAGATION_NOT_SUPPORTED</li>
  <li>PROPAGATION_NEVER</li>
  <li>PROPAGATION_NESTED</li>
</ul>

<p>ä¸‹é¢ä¸€ç§ç§æ¥è§£é‡Šï¼š</p>

<h4 id="propagationrequired">PROPAGATION_REQUIRED</h4>

<p>é»˜è®¤çš„äº‹åŠ¡ä¼ æ’­ç‰¹æ€§ï¼Œé€šå¸¸æƒ…å†µä¸‹æˆ‘ä»¬ç”¨è¿™ä¸ªäº‹åŠ¡ä¼ æ’­ç‰¹æ€§å°±å¯ä»¥äº†ã€‚å¦‚æœå½“å‰äº‹åŠ¡ä¸Šä¸‹æ–‡ä¸­æ²¡æœ‰äº‹åŠ¡ï¼Œé‚£ä¹ˆå°±ä¼šæ–°åˆ›å»ºä¸€ä¸ªäº‹åŠ¡ã€‚å¦‚æœå½“å‰çš„äº‹åŠ¡ä¸Šä¸‹æ–‡ä¸­å·²ç»æœ‰ä¸€ä¸ªäº‹åŠ¡äº†ï¼Œé‚£ä¹ˆæ–°å¼€å¯çš„äº‹åŠ¡ä¼šå¼€å¯ä¸€ä¸ªæ–°çš„é€»è¾‘äº‹åŠ¡èŒƒå›´ï¼Œä½†æ˜¯ä¼šå’ŒåŸæœ‰çš„äº‹åŠ¡å…±ç”¨ä¸€ä¸ªç‰©ç†äº‹åŠ¡ï¼Œæˆ‘ä»¬æš‚ä¸”ä¸å…³å¿ƒé€»è¾‘äº‹åŠ¡å’Œç‰©ç†äº‹åŠ¡çš„åŒºåˆ«ï¼Œå…ˆçœ‹çœ‹è¿™æ ·ä¼šå¯¼è‡´æ€æ ·çš„ä»£ç è¡Œä¸ºï¼š</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="nd">@Override</span>
</span><span class="line"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">txRollbackInnerTxRollbackPropagationRequires</span><span class="o">()</span> <span class="o">{</span>
</span><span class="line">    <span class="n">transactionTemplate</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="k">new</span> <span class="n">TransactionCallbackWithoutResult</span><span class="o">()</span> <span class="o">{</span>
</span><span class="line">        <span class="nd">@Override</span>
</span><span class="line">        <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doInTransactionWithoutResult</span><span class="o">(</span><span class="n">TransactionStatus</span> <span class="n">transactionStatus</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">            <span class="n">jdbcTemplate</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="s">&quot;insert into user (name, password) values (?, ?)&quot;</span><span class="o">,</span> <span class="s">&quot;Huang&quot;</span><span class="o">,</span>
</span><span class="line">                <span class="s">&quot;1111112&quot;</span><span class="o">);</span>
</span><span class="line">            <span class="n">transactionTemplate</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="k">new</span> <span class="n">TransactionCallbackWithoutResult</span><span class="o">()</span> <span class="o">{</span>
</span><span class="line">                <span class="nd">@Override</span>
</span><span class="line">                <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doInTransactionWithoutResult</span><span class="o">(</span><span class="n">TransactionStatus</span> <span class="n">status</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">                    <span class="n">jdbcTemplate</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="s">&quot;insert into user (name, password) values (?, ?)&quot;</span><span class="o">,</span>
</span><span class="line">                        <span class="s">&quot;Huang&quot;</span><span class="o">,</span> <span class="s">&quot;1111112&quot;</span><span class="o">);</span>
</span><span class="line">                    <span class="c1">// å†…éƒ¨äº‹åŠ¡è®¾ç½®äº† setRollbackOnlyï¼Œ</span>
</span><span class="line">                    <span class="n">status</span><span class="o">.</span><span class="na">setRollbackOnly</span><span class="o">();</span>
</span><span class="line">                <span class="o">}</span>
</span><span class="line">            <span class="o">});</span>
</span><span class="line">        <span class="o">}</span>
</span><span class="line">    <span class="o">});</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>è¿™æ®µä»£ç åœ¨ä¸€ä¸ªåµŒå¥—çš„äº‹åŠ¡å†…éƒ¨ï¼ˆå†…å¤–å±‚çš„äº‹åŠ¡éƒ½æ˜¯ PROPAGATION_REQUIRED çš„ï¼‰è®¾ç½®äº†å›æ»šï¼Œé‚£ä¹ˆå¯¹äºå¤–éƒ¨çš„äº‹åŠ¡æ¥è¯´ï¼Œå®ƒä¼šæ”¶åˆ°ä¸€ä¸ª <code>UnexpectedRollbackException</code>ï¼Œå› ä¸ºå†…éƒ¨çš„äº‹åŠ¡å’Œå¤–éƒ¨çš„äº‹åŠ¡æ˜¯å…±ç”¨ä¸€ä¸ªç‰©ç†äº‹åŠ¡çš„ï¼Œæ‰€ä»¥æ˜¾ç„¶å†…éƒ¨çš„äº‹åŠ¡å¿…ç„¶ä¼šå¯¼è‡´å¤–éƒ¨äº‹åŠ¡çš„å›æ»šï¼Œä½†æ˜¯å› ä¸ºè¿™ä¸ªå›æ»šå¹¶ä¸æ˜¯å¤–éƒ¨äº‹åŠ¡è‡ªå·±è®¾ç½®çš„ï¼Œæ‰€ä»¥å¤–å±‚äº‹åŠ¡å›æ»šçš„æ—¶å€™ä¼šéœ€è¦æŠ›å‡ºä¸€ä¸ª <code>UnexpectedRollbackException</code>ï¼Œè®©äº‹åŠ¡çš„è°ƒç”¨æ–¹çŸ¥é“è¿™ä¸ªå›æ»šå¹¶ä¸æ˜¯å¤–éƒ¨äº‹åŠ¡è‡ªå·±æƒ³è¦å›æ»šï¼Œæ˜¯å§‹æ–™æœªåŠçš„ã€‚</p>

<p>ä½†æ˜¯ï¼Œå¦‚æœå†…å±‚çš„äº‹åŠ¡ä¸æ˜¯é€šè¿‡è®¾ç½® <code>setRollbackOnly()</code> æ¥å›æ»šï¼Œè€Œæ˜¯æŠ›å‡ºäº† <code>RuntimeException</code> æ¥å›æ»šï¼Œé‚£ä¹ˆå¤–å±‚çš„äº‹åŠ¡æ¥æ”¶åˆ°äº†å†…å±‚æŠ›å‡ºçš„ <code>RuntimeException</code> ä¹Ÿä¼šè·Ÿç€å›æ»šï¼Œè¿™ä¸ªæ˜¯å¯ä»¥é¢„æ–™åˆ°çš„è¡Œä¸ºï¼Œæ‰€ä»¥ä¸ä¼šæœ‰ <code>UnexpectedRollbackException</code> ã€‚</p>

<h4 id="propagationsupports">PROPAGATION_SUPPORTS</h4>

<p>PROPAGATION_SUPPORTS çš„ç‰¹æ€§æ˜¯å¦‚æœäº‹åŠ¡ä¸Šä¸‹æ–‡ä¸­å·²ç»å­˜åœ¨ä¸€ä¸ªäº‹åŠ¡ï¼Œé‚£ä¹ˆæ–°çš„äº‹åŠ¡ï¼ˆä¼ æ’­ç‰¹æ€§ä¸º PROPAGATION_SUPPORTSï¼‰å°±ä¼šå’ŒåŸæ¥çš„äº‹åŠ¡å…±ç”¨ä¸€ä¸ªç‰©ç†äº‹åŠ¡ï¼Œå…¶è¡Œä¸ºå’Œ PROPAGATION_REQUIRED ä¸€æ ·ã€‚ä½†æ˜¯ï¼Œå¦‚æœå½“å‰äº‹åŠ¡ä¸Šä¸‹æ–‡ä¸­æ²¡æœ‰äº‹åŠ¡ï¼Œé‚£ä¹ˆ PROPAGATION_SUPPORTS å°±æŒ‰æ— äº‹åŠ¡çš„æ–¹å¼æ‰§è¡Œä»£ç ï¼š</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="nd">@Override</span>
</span><span class="line"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">txRollbackInnerTxRollbackPropagationSupports</span><span class="o">()</span> <span class="o">{</span>
</span><span class="line">    <span class="n">supportsTransactionTemplate</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="k">new</span> <span class="n">TransactionCallbackWithoutResult</span><span class="o">()</span> <span class="o">{</span>
</span><span class="line">        <span class="nd">@Override</span>
</span><span class="line">        <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doInTransactionWithoutResult</span><span class="o">(</span><span class="n">TransactionStatus</span> <span class="n">status</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">            <span class="n">jdbcTemplate</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="s">&quot;insert into user (name, password) values (?, ?)&quot;</span><span class="o">,</span> <span class="s">&quot;Huang&quot;</span><span class="o">,</span>
</span><span class="line">                <span class="s">&quot;1111112&quot;</span><span class="o">);</span>
</span><span class="line">            <span class="k">throw</span> <span class="k">new</span> <span class="nf">CustomRuntimeException</span><span class="o">();</span>
</span><span class="line">        <span class="o">}</span>
</span><span class="line">    <span class="o">});</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>çœ‹ä¸Šé¢è¿™æ®µä»£ç ï¼Œè™½ç„¶æˆ‘ä»¬åœ¨äº‹åŠ¡ï¼ˆPROPAGATION_SUPPORTS çš„ï¼‰ä¸­æŠ›å‡ºäº†ä¸€ä¸ª <code>RuntimeException</code>ï¼Œä½†æ˜¯å› ä¸ºå…¶äº‹åŠ¡ä¸Šä¸‹æ–‡ä¸­æ²¡æœ‰äº‹åŠ¡å­˜åœ¨ï¼Œæ‰€ä»¥è¿™æ®µä»£ç å®é™…ä¸Šæ˜¯ä»¥æ— äº‹åŠ¡çš„æ–¹å¼æ‰§è¡Œçš„ï¼Œå› æ­¤ä»£ç ä¸­çš„ <code>jdbcTemplate.update()</code> æ“ä½œä¹Ÿä¸ä¼šè¢«å›æ»šã€‚</p>

<h4 id="propagationmandatory">PROPAGATION_MANDATORY</h4>

<p>PROPAGATION_MANDATORY è¦æ±‚äº‹åŠ¡ä¸Šä¸‹æ–‡ä¸­å¿…é¡»å­˜åœ¨äº‹åŠ¡ï¼Œå¦‚æœäº‹åŠ¡ä¸Šä¸‹æ–‡ä¸­å­˜åœ¨äº‹åŠ¡ï¼Œé‚£ä¹ˆå…¶è¡Œä¸ºå’Œ <code>PROPAGATION_REQUIRED</code> ä¸€æ ·ã€‚å¦‚æœå½“å‰äº‹åŠ¡ä¸Šä¸‹æ–‡ä¸­æ²¡æœ‰äº‹åŠ¡ï¼Œé‚£ä¹ˆå°±ä¼šæŠ›å‡º <code>IllegalTransactionStateException</code>ï¼Œæ¯”å¦‚ä¸‹é¢è¿™æ®µä»£ç å°±ä¼šè¿™æ ·ï¼š</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="nd">@Override</span>
</span><span class="line"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">txRollbackInnerTxRollbackPropagationMandatory</span><span class="o">()</span> <span class="o">{</span>
</span><span class="line">    <span class="n">mandatoryTransactionTemplate</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="k">new</span> <span class="n">TransactionCallbackWithoutResult</span><span class="o">()</span> <span class="o">{</span>
</span><span class="line">        <span class="nd">@Override</span>
</span><span class="line">        <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doInTransactionWithoutResult</span><span class="o">(</span><span class="n">TransactionStatus</span> <span class="n">transactionStatus</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">            <span class="n">jdbcTemplate</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="s">&quot;insert into user (name, password) values (?, ?)&quot;</span><span class="o">,</span> <span class="s">&quot;Huang&quot;</span><span class="o">,</span>
</span><span class="line">                <span class="s">&quot;1111112&quot;</span><span class="o">);</span>
</span><span class="line">        <span class="o">}</span>
</span><span class="line">    <span class="o">});</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h4 id="propagationrequiresnew">PROPAGATION_REQUIRES_NEW</h4>

<p>PROPAGATION_REQUIRES_NEW æ— è®ºå½“å‰äº‹åŠ¡ä¸Šä¸‹æ–‡ä¸­æœ‰æ²¡æœ‰äº‹åŠ¡ï¼Œéƒ½ä¼šå¼€å¯ä¸€ä¸ªæ–°çš„äº‹åŠ¡ï¼Œå¹¶ä¸”å’ŒåŸæ¥çš„äº‹åŠ¡å®Œå…¨æ˜¯éš”ç¦»çš„ï¼Œå¤–å±‚äº‹åŠ¡çš„å›æ»šä¸ä¼šå½±å“åˆ°å†…å±‚çš„äº‹åŠ¡ï¼Œå†…å±‚äº‹åŠ¡çš„å›æ»šä¹Ÿä¸ä¼šå½±å“åˆ°å¤–å±‚çš„äº‹åŠ¡ï¼ˆ<strong>è¿™ä¸ªè¯´æ³•å¾—ç¨å¾®æ‰“ç‚¹æŠ˜æ‰£ï¼šå› ä¸ºå¦‚æœå†…å±‚æŠ›å‡º <code>RuntimeException</code> çš„è¯ï¼Œé‚£ä¹ˆå¤–å±‚è¿˜æ˜¯ä¼šæ”¶åˆ°è¿™ä¸ªå¼‚å¸¸å¹¶ä¸”è§¦å‘å›æ»š</strong>ï¼‰ï¼Œæˆ‘ä»¬åˆ†æä¸‹å‡ æ®µä»£ç ï¼š</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="nd">@Override</span>
</span><span class="line"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">txRollbackInnerTxRollbackPropagationRequiresNew</span><span class="o">()</span> <span class="o">{</span>
</span><span class="line">    <span class="n">transactionTemplate</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="k">new</span> <span class="n">TransactionCallbackWithoutResult</span><span class="o">()</span> <span class="o">{</span>
</span><span class="line">        <span class="nd">@Override</span>
</span><span class="line">        <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doInTransactionWithoutResult</span><span class="o">(</span><span class="n">TransactionStatus</span> <span class="n">transactionStatus</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">
</span><span class="line">            <span class="n">requiresNewTransactionTemplate</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="k">new</span> <span class="n">TransactionCallbackWithoutResult</span><span class="o">()</span> <span class="o">{</span>
</span><span class="line">                <span class="nd">@Override</span>
</span><span class="line">                <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doInTransactionWithoutResult</span><span class="o">(</span><span class="n">TransactionStatus</span> <span class="n">status</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">                    <span class="n">jdbcTemplate</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="s">&quot;insert into user (name, password) values (?, ?)&quot;</span><span class="o">,</span>
</span><span class="line">                        <span class="s">&quot;Huang&quot;</span><span class="o">,</span> <span class="s">&quot;1111112&quot;</span><span class="o">);</span>
</span><span class="line">                <span class="o">}</span>
</span><span class="line">            <span class="o">});</span>
</span><span class="line">
</span><span class="line">            <span class="c1">// å¤–éƒ¨äº‹åŠ¡å‘ç”Ÿå›æ»šï¼Œå†…éƒ¨äº‹åŠ¡åº”è¯¥ä¸å—å½±å“è¿˜æ˜¯èƒ½å¤Ÿæäº¤</span>
</span><span class="line">            <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">();</span>
</span><span class="line">        <span class="o">}</span>
</span><span class="line">    <span class="o">});</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>è¿™æ®µä»£ç å¤–å±‚çš„äº‹åŠ¡å›æ»šäº†ï¼Œä½†æ˜¯ä¸ä¼šå½±å“åˆ°å†…å±‚çš„äº‹åŠ¡çš„æäº¤ï¼Œå†…å±‚äº‹åŠ¡ä¸å—å¤–å±‚çš„äº‹åŠ¡çš„å½±å“ã€‚å†çœ‹ï¼š</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="nd">@Override</span>
</span><span class="line"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">txRollbackInnerTxRollbackPropagationRequiresNew2</span><span class="o">()</span> <span class="o">{</span>
</span><span class="line">    <span class="n">transactionTemplate</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="k">new</span> <span class="n">TransactionCallbackWithoutResult</span><span class="o">()</span> <span class="o">{</span>
</span><span class="line">        <span class="nd">@Override</span>
</span><span class="line">        <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doInTransactionWithoutResult</span><span class="o">(</span><span class="n">TransactionStatus</span> <span class="n">transactionStatus</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">            <span class="n">jdbcTemplate</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="s">&quot;insert into user (name, password) values (?, ?)&quot;</span><span class="o">,</span> <span class="s">&quot;Huang&quot;</span><span class="o">,</span>
</span><span class="line">                <span class="s">&quot;1111112&quot;</span><span class="o">);</span>
</span><span class="line">            <span class="c1">// Nested transaction committed.</span>
</span><span class="line">            <span class="n">requiresNewTransactionTemplate</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="k">new</span> <span class="n">TransactionCallbackWithoutResult</span><span class="o">()</span> <span class="o">{</span>
</span><span class="line">                <span class="nd">@Override</span>
</span><span class="line">                <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doInTransactionWithoutResult</span><span class="o">(</span><span class="n">TransactionStatus</span> <span class="n">status</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">                    <span class="n">jdbcTemplate</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="s">&quot;insert into user (name, password) values (?, ?)&quot;</span><span class="o">,</span>
</span><span class="line">                        <span class="s">&quot;Huang&quot;</span><span class="o">,</span> <span class="s">&quot;1111112&quot;</span><span class="o">);</span>
</span><span class="line">                    <span class="c1">// å†…éƒ¨äº‹åŠ¡å‘ç”Ÿå›æ»šï¼Œä½†æ˜¯å¤–éƒ¨äº‹åŠ¡ä¸åº”è¯¥å‘ç”Ÿå›æ»š</span>
</span><span class="line">                    <span class="n">status</span><span class="o">.</span><span class="na">setRollbackOnly</span><span class="o">();</span>
</span><span class="line">                <span class="o">}</span>
</span><span class="line">            <span class="o">});</span>
</span><span class="line">        <span class="o">}</span>
</span><span class="line">    <span class="o">});</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>è¿™æ®µä»£ç åœ¨å†…å±‚äº‹åŠ¡ä¸Šè®¾ç½®äº† <code>setRollbackOnly</code>ï¼Œå†…å±‚äº‹åŠ¡è‚¯å®šä¼šå›æ»šï¼Œä½†æ˜¯ç”±äºå†…å±‚äº‹åŠ¡å’Œå¤–å±‚äº‹åŠ¡æ˜¯éš”ç¦»çš„ï¼Œæ‰€ä»¥å¤–å±‚äº‹åŠ¡ä¸ä¼šè¢«å›æ»šã€‚å†çœ‹ï¼š</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="nd">@Override</span>
</span><span class="line"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">txRollbackInnerTxRollbackPropagationRequiresNew3</span><span class="o">()</span> <span class="o">{</span>
</span><span class="line">    <span class="n">transactionTemplate</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="k">new</span> <span class="n">TransactionCallbackWithoutResult</span><span class="o">()</span> <span class="o">{</span>
</span><span class="line">        <span class="nd">@Override</span>
</span><span class="line">        <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doInTransactionWithoutResult</span><span class="o">(</span><span class="n">TransactionStatus</span> <span class="n">transactionStatus</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">            <span class="n">jdbcTemplate</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="s">&quot;insert into user (name, password) values (?, ?)&quot;</span><span class="o">,</span> <span class="s">&quot;Huang&quot;</span><span class="o">,</span>
</span><span class="line">                <span class="s">&quot;1111112&quot;</span><span class="o">);</span>
</span><span class="line">
</span><span class="line">            <span class="n">requiresNewTransactionTemplate</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="k">new</span> <span class="n">TransactionCallbackWithoutResult</span><span class="o">()</span> <span class="o">{</span>
</span><span class="line">                <span class="nd">@Override</span>
</span><span class="line">                <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doInTransactionWithoutResult</span><span class="o">(</span><span class="n">TransactionStatus</span> <span class="n">status</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">                    <span class="n">jdbcTemplate</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="s">&quot;insert into user (name, password) values (?, ?)&quot;</span><span class="o">,</span>
</span><span class="line">                        <span class="s">&quot;Huang&quot;</span><span class="o">,</span> <span class="s">&quot;1111112&quot;</span><span class="o">);</span>
</span><span class="line">                    <span class="c1">// å†…éƒ¨äº‹åŠ¡æŠ›å‡º RuntimeExceptionï¼Œå¤–éƒ¨äº‹åŠ¡æ¥æ”¶åˆ°å¼‚å¸¸ï¼Œä¾æ—§ä¼šå‘ç”Ÿå›æ»š</span>
</span><span class="line">                    <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">();</span>
</span><span class="line">                <span class="o">}</span>
</span><span class="line">            <span class="o">});</span>
</span><span class="line">        <span class="o">}</span>
</span><span class="line">    <span class="o">});</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>è¿™æ®µä»£ç åœ¨å†…å±‚äº‹åŠ¡æŠ›å‡ºäº†ä¸€ä¸ª <code>RuntimeException</code>ï¼Œè™½ç„¶å†…å±‚äº‹åŠ¡å’Œå¤–å±‚äº‹åŠ¡åœ¨äº‹åŠ¡ä¸Šæ˜¯éš”ç¦»ï¼Œä½†æ˜¯ <code>RuntimeException</code> æ˜¾ç„¶è¿˜ä¼šæŠ›åˆ°å¤–å±‚å»ï¼Œæ‰€ä»¥å¤–å±‚äº‹åŠ¡ä¹Ÿä¼šå‘ç”Ÿå›æ»šã€‚</p>

<h4 id="propagationnotsupported">PROPAGATION_NOT_SUPPORTED</h4>

<p>PROPAGATION_NOT_SUPPORTED ä¸ç®¡å½“å‰äº‹åŠ¡ä¸Šä¸‹æ–‡ä¸­æœ‰æ²¡æœ‰äº‹åŠ¡ï¼Œä»£ç éƒ½ä¼šåœ¨æŒ‰ç…§æ— äº‹åŠ¡çš„æ–¹å¼æ‰§è¡Œï¼Œçœ‹ä¸‹é¢è¿™æ®µä»£ç ï¼š</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="nd">@Override</span>
</span><span class="line"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">txRollbackInnerTxRollbackPropagationNotSupport</span><span class="o">()</span> <span class="o">{</span>
</span><span class="line">    <span class="n">transactionTemplate</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="k">new</span> <span class="n">TransactionCallbackWithoutResult</span><span class="o">()</span> <span class="o">{</span>
</span><span class="line">        <span class="nd">@Override</span>
</span><span class="line">        <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doInTransactionWithoutResult</span><span class="o">(</span><span class="n">TransactionStatus</span> <span class="n">transactionStatus</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">            <span class="n">jdbcTemplate</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="s">&quot;insert into user (name, password) values (?, ?)&quot;</span><span class="o">,</span> <span class="s">&quot;Huang&quot;</span><span class="o">,</span>
</span><span class="line">                <span class="s">&quot;1111112&quot;</span><span class="o">);</span>
</span><span class="line">            <span class="n">notSupportedTransactionTemplate</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="k">new</span> <span class="n">TransactionCallbackWithoutResult</span><span class="o">()</span> <span class="o">{</span>
</span><span class="line">                <span class="nd">@Override</span>
</span><span class="line">                <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doInTransactionWithoutResult</span><span class="o">(</span><span class="n">TransactionStatus</span> <span class="n">status</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">                    <span class="n">jdbcTemplate</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="s">&quot;insert into user (name, password) values (?, ?)&quot;</span><span class="o">,</span>
</span><span class="line">                        <span class="s">&quot;Huang&quot;</span><span class="o">,</span> <span class="s">&quot;1111112&quot;</span><span class="o">);</span>
</span><span class="line">                <span class="o">}</span>
</span><span class="line">            <span class="o">});</span>
</span><span class="line">            <span class="c1">// å¤–éƒ¨äº‹åŠ¡å›æ»šï¼Œä¸ä¼šæŠŠå†…éƒ¨çš„ä¹Ÿè¿ç€å›æ»š </span>
</span><span class="line">            <span class="n">transactionStatus</span><span class="o">.</span><span class="na">setRollbackOnly</span><span class="o">();</span>
</span><span class="line">        <span class="o">}</span>
</span><span class="line">    <span class="o">});</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>ä¸Šé¢è¿™æ®µä»£ç ä¸­è™½ç„¶å¤–éƒ¨äº‹åŠ¡å‘ç”Ÿäº†å›æ»šï¼Œä½†æ˜¯ç”±äºå†…éƒ¨çš„äº‹åŠ¡æ˜¯ PROPAGATION_NOT_SUPPORTEDï¼Œæ ¹æœ¬ä¸åœ¨å¤–å±‚çš„äº‹åŠ¡èŒƒå›´å†…ï¼Œæ‰€ä»¥å†…å±‚äº‹åŠ¡ä¸ä¼šå‘ç”Ÿå›æ»šã€‚</p>

<h4 id="propagationnever">PROPAGATION_NEVER</h4>

<p>PROPAGATION_NEVER å¦‚æœå½“å‰äº‹åŠ¡ä¸Šä¸‹æ–‡ä¸­å­˜åœ¨äº‹åŠ¡ï¼Œå°±ä¼šæŠ›å‡º <code>IllegalTransactionStateException</code> å¼‚å¸¸ï¼Œè‡ªå·±ä¹Ÿä¼šæŒ‰ç…§éäº‹åŠ¡çš„æ–¹å¼æ‰§è¡Œ</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="nd">@Override</span>
</span><span class="line"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">txRollbackInnerTxRollbackPropagationNever2</span><span class="o">()</span> <span class="o">{</span>
</span><span class="line">    <span class="n">transactionTemplate</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="k">new</span> <span class="n">TransactionCallbackWithoutResult</span><span class="o">()</span> <span class="o">{</span>
</span><span class="line">        <span class="nd">@Override</span>
</span><span class="line">        <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doInTransactionWithoutResult</span><span class="o">(</span><span class="n">TransactionStatus</span> <span class="n">transactionStatus</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">            <span class="n">jdbcTemplate</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="s">&quot;insert into user (name, password) values (?, ?)&quot;</span><span class="o">,</span> <span class="s">&quot;Huang&quot;</span><span class="o">,</span>
</span><span class="line">                <span class="s">&quot;1111112&quot;</span><span class="o">);</span>
</span><span class="line">            <span class="n">neverTransactionTemplate</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="k">new</span> <span class="n">TransactionCallbackWithoutResult</span><span class="o">()</span> <span class="o">{</span>
</span><span class="line">                <span class="nd">@Override</span>
</span><span class="line">                <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doInTransactionWithoutResult</span><span class="o">(</span><span class="n">TransactionStatus</span> <span class="n">status</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">                    <span class="n">jdbcTemplate</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="s">&quot;insert into user (name, password) values (?, ?)&quot;</span><span class="o">,</span>
</span><span class="line">                        <span class="s">&quot;Huang&quot;</span><span class="o">,</span> <span class="s">&quot;1111112&quot;</span><span class="o">);</span>
</span><span class="line">                <span class="o">}</span>
</span><span class="line">            <span class="o">});</span>
</span><span class="line">        <span class="o">}</span>
</span><span class="line">    <span class="o">});</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>æ¯”å¦‚ä¸Šé¢è¿™æ®µä»£ç ï¼Œåœ¨ä¸€ä¸ª PROPAGATION_REQUIRES é‡Œé¢åµŒå…¥äº†ä¸€ä¸ª PROPAGATION_NEVERï¼Œå†…å±‚å°±ä¼šæŠ›å‡ºä¸€ä¸ª <code>IllegalTransactionStateException</code>ï¼Œå¯¼è‡´å¤–å±‚äº‹åŠ¡è¢«å›æ»šã€‚</p>

<h4 id="propagationnested">PROPAGATION_NESTED</h4>

<p>PROPAGATION_NESTED åªèƒ½åº”ç”¨äºåƒ DataSource è¿™æ ·çš„äº‹åŠ¡ï¼Œå¯ä»¥é€šè¿‡åœ¨ä¸€ä¸ªäº‹åŠ¡å†…éƒ¨å¼€å¯ä¸€ä¸ª PROPAGATION_NESTED è€Œè¾¾åˆ°ä¸€ä¸ªäº‹åŠ¡å†…éƒ¨æœ‰å¤šä¸ªä¿å­˜ç‚¹çš„æ•ˆæœï¼Œä¸€ä¸ªå†…åµŒçš„äº‹åŠ¡å‘ç”Ÿå›æ»šï¼Œåªä¼šå›æ»šåˆ°å®ƒè‡ªå·±çš„ä¿å­˜ç‚¹ï¼Œå¤–å±‚äº‹åŠ¡è¿˜ä¼šç»§ç»­ï¼Œæ¯”å¦‚ä¸‹é¢è¿™æ®µä»£ç ï¼š</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="nd">@Override</span>
</span><span class="line"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">txRollbackInnerTxRollbackPropagationNested</span><span class="o">()</span> <span class="o">{</span>
</span><span class="line">    <span class="n">nestedTransactionTemplate</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="k">new</span> <span class="n">TransactionCallbackWithoutResult</span><span class="o">()</span> <span class="o">{</span>
</span><span class="line">        <span class="nd">@Override</span>
</span><span class="line">        <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doInTransactionWithoutResult</span><span class="o">(</span><span class="n">TransactionStatus</span> <span class="n">transactionStatus</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">            <span class="n">jdbcTemplate</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="s">&quot;insert into user (name, password) values (?, ?)&quot;</span><span class="o">,</span> <span class="s">&quot;Huang&quot;</span><span class="o">,</span>
</span><span class="line">                <span class="s">&quot;1111112&quot;</span><span class="o">);</span>
</span><span class="line">
</span><span class="line">            <span class="n">nestedTransactionTemplate</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="k">new</span> <span class="n">TransactionCallbackWithoutResult</span><span class="o">()</span> <span class="o">{</span>
</span><span class="line">                <span class="nd">@Override</span>
</span><span class="line">                <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doInTransactionWithoutResult</span><span class="o">(</span><span class="n">TransactionStatus</span> <span class="n">status</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">                    <span class="n">jdbcTemplate</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="s">&quot;insert into user (name, password) values (?, ?)&quot;</span><span class="o">,</span>
</span><span class="line">                        <span class="s">&quot;Huang&quot;</span><span class="o">,</span> <span class="s">&quot;1111112&quot;</span><span class="o">);</span>
</span><span class="line">                    <span class="c1">// å†…éƒ¨äº‹åŠ¡è®¾ç½®äº† rollbackOnlyï¼Œå¤–éƒ¨äº‹åŠ¡åº”è¯¥ä¸å—å½±å“ï¼Œå¯ä»¥ç»§ç»­æäº¤</span>
</span><span class="line">                    <span class="n">status</span><span class="o">.</span><span class="na">setRollbackOnly</span><span class="o">();</span>
</span><span class="line">                <span class="o">}</span>
</span><span class="line">            <span class="o">});</span>
</span><span class="line">        <span class="o">}</span>
</span><span class="line">    <span class="o">});</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>å†…å±‚çš„äº‹åŠ¡å‘ç”Ÿäº†å›æ»šï¼Œåªä¼šå›æ»šå…¶å†…éƒ¨çš„æ“ä½œï¼Œä¸ä¼šå½±å“åˆ°å¤–å±‚çš„äº‹åŠ¡ã€‚</p>

<h3 id="section">æ€»ç»“</h3>

<p>Spring çš„äº‹åŠ¡ä¼ æ’­ç‰¹æ€§ç§ç±»ç¹å¤šï¼Œå¤§å¤šæ•°éƒ½æ¥è‡ªäº EJB çš„äº‹åŠ¡ï¼Œå¤§å®¶å¯ä»¥è‡ªå·±å†™ä¸€äº›å°çš„ç¨‹åºæ¥æµ‹è¯• Spring å„ä¸ªäº‹åŠ¡ç‰¹æ€§çš„è¡Œä¸ºï¼ŒåŠ æ·±å°è±¡ï¼Œæˆ‘è‡ªå·±ä¹Ÿå†™äº†ä¸€ä¸ªå·¥ç¨‹ï¼Œé€šè¿‡å•å…ƒæµ‹è¯•å»æµ‹è¯•å„ä¸ªäº‹åŠ¡ä¼ æ’­ç‰¹æ€§çš„è¡Œä¸ºï¼Œå¤§å®¶æœ‰å…´è¶£çš„è¯ï¼Œå¯ä»¥ä¸‹è¿‡æ¥è·‘ä¸€ä¸‹ï¼š<a href="https://github.com/khotyn/spring-tx-test">https://github.com/khotyn/spring-tx-test</a></p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">khotyn</span></span>

      








  


<time datetime="2013-09-14T18:06:00-05:00" pubdate data-updated="true">Sep 14<span>th</span>, 2013</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/java/'>Java</a>, <a class='category' href='/blog/categories/programming/'>Programming</a>, <a class='category' href='/blog/categories/spring/'>Spring</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  
  
</div>

    
    
    <section>
      <h1>Comments</h1>
      <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
    </section>
    
    <ul class="pager">
      
      <li class="previous"><a class="basic-alignment left"
        href="/blog/2013/08/03/dumping-class-from-jvm/" title="Previous Post:
        ä» JVM ä¸­ dump class çš„å‡ ç§æ–¹æ³•">&laquo; ä» JVM ä¸­ dump class çš„å‡ ç§æ–¹æ³•</a></li>
      
      <li><a href="/blog/archives">Blog Archives</a></li>
      
      <li class="next"><a class="basic-alignment right" href="/blog/2013/09/14/perfect-afternoon/"
        title="Next Post: ç†æƒ³çš„ä¸‹åˆ">ç†æƒ³çš„ä¸‹åˆ
        &raquo;</a></li>
      
    </ul>
  </footer>
</article>

<aside class="sidebar-nav span3">
  
    <section class="well">
  <ul id="recent_posts" class="nav nav-list">
    <li class="nav-header">Recent Posts</li>
    
      <li class="post">
        <a href="/blog/2019/10/06/new-zealand/">æ–°è¥¿å…°æ¸¸è®°</a>
      </li>
    
      <li class="post">
        <a href="/blog/2019/10/06/the-legend-of-heroes-4/">é—ªä¹‹è½¨è¿¹ 4 ç©åæ„Ÿ</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/03/24/springboot-on-kubernetes/">SpringBoot on Kubernetes</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/03/21/app-cds/">Java 10 æ–°ç‰¹æ€§ä¹‹ AppCDS</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/02/19/cloud-native-infrastrcuture/">Cloud Native Infrastrcuture é˜…è¯»ç¬”è®°</a>
      </li>
    
  </ul>
</section>

<section class="well">
  <ul id="gh_repos" class="nav">
    <li class="nav-header">GitHub Repos</li>
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/khotyn">@khotyn</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        github.showRepos({
            user: 'khotyn',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/asides/github.js" type="text/javascript"> </script>
</section>






  
</aside>


    </div>
  </div>
  <footer role="contentinfo" class="page-footer"><hr>
<p>
  Copyright &copy; 2019 - khotyn -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'khotynblog';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://khotyn.github.com/blog/2013/09/14/spring-tx-propagation/';
        var disqus_url = 'http://khotyn.github.com/blog/2013/09/14/spring-tx-propagation/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'https://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>











</body>
</html>
